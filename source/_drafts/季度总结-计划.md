## 季度总结

除了完成业务需求，我做了以下的一些事情

### 引入队列

API 项目引入队列，改造代码为异步执行

### 框架升级

研究框架升级最平稳的方式，然后写了 [这篇博客（只写到一半）](http://sakyavarro.cn/post/%E8%AE%B0%E5%BD%95-%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E5%B0%86%E4%B8%80%E4%B8%AA-Laravel-5-2-%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7%E8%87%B3-5-8) 记录了框架升级的过程和要点

### 整理、规范项目代码

首先是移除了大部分废弃无用的文件、大段重复或无意义的代码，然后修复了一些代码问题，比如方法不正确调用，在循环中查询数据库，N + 1 查询问题，判断逻辑不严谨，设计模式错误使用导致的性能问题等。

按照 PSR-2 规范统一了部分文件的代码风格

### 规范开发工作流

整合一些开发和测试中需要用到的工具，提高开发效率、代码执行效率，减少代码错误

以下的这些工具都只在本地和测试环境引入，不会部署到线上服务器、造成性能影响

#### 引入 Ide-helper

因为 Laravel 使用了 IOC 容器，所以很多时候 IDE 不能自动补全一个类下的属性、方法，可以避免大部分因单词拼写错误、粗心引起的报错。

#### 引入 Debugbar

在预发环境的 https://testservice.firmoo.com/ 的页面左下角可以看到一个调试工具栏，引入这个组件主要是为了查看一个功能进行的 SQL 查询以及代码执行效率

#### 引入 Telescope

API 项目最重要的指标就是接口的响应速度，引入这个工具也是为了查看 SQL 查询和代码执行效率

#### 引入 Larastan 和 Php Inspections

在代码执行前先进行代码静态分析可以有效发现代码错误，这点和 C、Java 等编译型语言类似，一但编译不通过，代码就无法打包（执行）

#### 帮助其他同事搭建 docker 开发环境

开发环境统一在团队协同开发时很重要，除了 LNMP 环境，还有其他软件像 redis、ES、队列、 各类 PHP 拓展都需要统一。此外还协助其他同事使用 Xdebug 进行调试，可以更准确得定位 BUG、查看代码执行过程

### 分享知识

我很喜欢学习新的技术，也喜欢把一些好的东西分享给周围的人，这是个很平常的事，不过我觉得还是对周围的同事造成了一些好的影响

### 对代码的追求

写代码时不会因为时间紧，就匆忙写一堆代码交差。除了符合代码规范和代码设计原则，我很注重最佳实践和代码简洁之道，力求代码逻辑明晰、可维护性强、拓展性高、可读性高。也会经常回顾我之前写好的代码，重新审视是否有可优化的地方

## 没有处理好的地方

### 代码

对一些底层的知识不熟悉

### 服务器

因为对 Linux 系统和软件的了解不足，造成在操作线上服务器时出现了一些问题

### 图片处理服务

因对 Amazon 服务不熟悉，造成图片处理服务任务被搁置

## 计划

### 本职工作

完成既定的任务

### 项目部署

目前后端项目的部署存在些问题，主要在于不支持代码灰度发布、不可立刻回滚代码（切换代码版本）、不支持集群部署。现在已经有一些完善的解决方案，可以在项目中实施，这样可以为将来做负载均衡、横向扩容、serverless 、高可用打好基础

### 接口响应速度

像 API 这种 I/O 密集型的项目如果改为 Laravel + Swoole，我预计大部分接口的响应时间 都会降到 100 ms 以下。我在的第一家公司用的 Yaf + Swoole，第二家公司用的原生 PHP + Swoole，公司项目的接口响应速度都在 50 ms 以下。另外可以考虑 PHP 7.4 的 JIT 功能

### Service 引入队列

Service 有很多长耗时的任务，这些任务可以改造成队列执行

### 运维

将来服务器数量比较多时，可以装一套监控系统保证服务器正常运行，比如 Zabbix 之类

MySQL 数据库备份、Redis 持久化等将来也需要考虑

### 开发人员自身的技能提升

我认为开发人员每天应空出 1-2 小时的时间来学习，提升自己的水平。

我目前的学习计划主要是 3 个方向：

- 算法和数据结构。我平时会在 [力扣](https://leetcode-cn.com/) 刷题，学习算法和计算机底层知识
- Linux。服务器软件方面我对自动化部署、docker、k8s 比较感兴趣；Linux 内核和原理方面我在研究协程，因为 PHP 是单线程，会阻塞线程中其他代码执行
- Vue。目前学会些了，也在 Service 中用 Vue 写代码了，算是初级水平