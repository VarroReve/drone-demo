### 根据子域名区分应用站点环境

当请求的接口域名为 'uk.api.firmoo.com' 或 ‘uk.api.test.firmoo.com’ 时设置本次的程序运行环境为英国站，访问 'www.api.firmoo.com' 或 'www.api.test.firmoo.com’ 时设置为美国站，根据站点不同，返回不同站点下的数据。默认为美国站。

API 项目做全局处理，以支持根据子域名自动切换站点。

Service 项目增加站点切换选项卡，以支持管理不同站点下的数据。

工作量占比：5%

工时：2 天（王隆）

### 业务逻辑代码修改

后端项目中大概 50% ~ 70% 的增删改查要改，以支持数据筛选。

工作量占比：50%

工时：2 ~ 3 周（四个后端同时开发，修改自己负责的模块的代码，每个人的工时不一样，整体上可能需要 2 ~ 3 周）

### 处理代码与数据库数据耦合

提取代码中所有与数据库耦合的 ID，使用一张多对多多态关联表存储，并增加站点 ID 和标签以达到不同站点使用不同数据的目的。

目前两个项目中大约有 200 处耦合，大部分存在于各个配置文件中，小部分写死在代码里，具体要处理哪些耦合取决于需求。

工作量占比：10%

工时：

- 实现解决耦合的具体方案：1 天（王隆）
- 解决代码中的耦合：取决于需求

### 转移 V1 后台的模块到 Service

- 优惠券管理
- 用户管理
- 联盟系统
- 统计报告
- 辅助功能 / 工具
- 其他模块

需要产品先统计下那些模块在用，哪些被废弃了，最终要转移哪些

转移的过程中做多站点改造

工作量占比：25%

工时：1 ~ 2 周，取决于哪些要搬（王隆，陈越）

### 其他

- 存在其他一些未考虑到的问题
- 前后端联调

工作量占比：10%

工时：1 ~ 3 天

## 总工时

21 ~ 35 天