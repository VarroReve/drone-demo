kind: pipeline
type: kubernetes
name: build

steps:
#  - name: build
#    image: plugins/docker
#    settings:
#      use_cache: true
#      username:
#        from_secret: dockerhub_username
#      password:
#        from_secret: dockerhub_password
#      repo: sakyavarro/blog
#      tags: latest

#  - name: deploy_production
#    image: pelotech/drone-helm3
#    settings:
#      namespace: varroreve
#      helm_command: upgrade
#      chart: ./helm
#      release: blog-staging
#      api_server: http://kuboard.varro.buzz/k8s-api/
#      kubernetes_token: eyJhbGciOiJSUzI1NiIsImtpZCI6IldaTEdWem53VFVrMHBXOUYxT3A1WWo0S0MyOWhSUnpaa0ZPUjlXc3pCMVEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJoZWxtLXRva2VuLW16NGhuIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImhlbG0iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI5MGNlMWYyNC0zYjZhLTQyMDctYjRkYy04MDU2NTE2NjkyZTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06aGVsbSJ9.CiuIGOPc_JIil1TOiJZN3e48ffcwRNaceznsXwYagdimT9USfOu1ugMLV3wy42DSHt5h2YPUpt7QLulzvvc2ZjhWNz8CO8YwEoS8CyOffZ022wCm-wWau-He4O6-q6mj5PXrXjQHTLrEvgEXld9lsxKbnlaEScx0STazK8TELxnKIGLJ95RGGcVTmzYc5rhZpQwcNZeZlmfFH8rTPDERHqFdL3y0HdbPxuNITtCQDHCSpgH8_muAaN_SLAQgtPuLA8ZL1URrZbgZjXWWMxfJjUZMdkJQG-sbfTaorWXJTvP9H3XkEpgJ3GmypNx_y38yEYzerEtdWZrbsrKloPgp4g

  - name: deploy
    image: bitsbeats/drone-helm3
    settings:
      kube_api_server: http://kuboard.varro.buzz/k8s-api/
      kube_token: eyJhbGciOiJSUzI1NiIsImtpZCI6IldaTEdWem53VFVrMHBXOUYxT3A1WWo0S0MyOWhSUnpaa0ZPUjlXc3pCMVEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJ2YXJyb3JldmUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoidGVzdC10b2tlbi1ycXQ5NCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJ0ZXN0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYjMzYjIyYWYtZGU0OC00NGFkLTlmOTktZTllYTlhMDc1ZGM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OnZhcnJvcmV2ZTp0ZXN0In0.k7EsoQOVBAYCbID4W2kum48-9RlcfXjaRLXIDiCnEKPQECcLCKIvQuIH_9GGdRlRL1VJ-Jbsu-u9lyNuuARJRrFOEAahB0PUYnmQzICDrnlShrj78Frz6lNl1h8pZOZq1akCfE2C_EMLW6V1jBTPtiPn8Be29Itsk74OWrlwNK3sLWp3pScltIuAuNufxsGhpnq7V02VL8sBnhsRFt70rWQClbKjSMK7Fn9nj2e7fLNIxp1nIXAATHe0J3OZHhUwKMxCv4_BI1tB5NVJpKxLhW-fZBoxCcpjJo4WTrTeNhI-Tq8_o3oKzLzeNKTJF4u4nS5Ymoa3yCWrNng0DR9Grg
      namespace: varroreve
      chart: ./helm
      release: blog-staging
      wait: true
      force: true


#  - name: notify
#    image: lddsb/drone-dingtalk-message
#    settings:
#      token:
#        from_secret: dingtalk_token_insta_bot_drone_1
#      type: markdown

trigger:
  branch:
    - master
