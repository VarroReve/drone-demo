kind: pipeline
type: kubernetes
name: build

steps:
  - name: build
    image: plugins/docker
    settings:
      use_cache: true
      username:
        from_secret: dockerhub_username
      password:
        from_secret: dockerhub_password
      repo: sakyavarro/blog
      tags: latest

  - name: deploy
    image: bitsbeats/drone-helm3
    settings:
      kube_api_server:
        from_secret: kube_api_server
      kube_token:
        from_secret: kube_token
      namespace: varroreve
      chart: ./helm
      release: web-blog-test
      wait: true
      force: true
      kube_skip_tls: true

  - name: notify
    image: lddsb/drone-dingtalk-message
    settings:
      token:
        from_secret: dingtalk_token_insta_bot_drone_1
      type: markdown

  - name: notify2
    image: lddsb/drone-dingtalk-message
    settings:
      token: 61475d3297ab163609b0154957d706de5d3de658e66226d1bd1bac4e5da86b00
      type: markdown

trigger:
  branch:
    - master



